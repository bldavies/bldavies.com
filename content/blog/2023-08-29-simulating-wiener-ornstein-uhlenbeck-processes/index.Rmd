---
title: Simulating Wiener and Ornstein-Uhlenbeck processes
topics: [mathematics]
hidden: true
summary: I show how to simulate Wiener and Ornstein-Uhlenbeck processes using R.
---

```{r setup, echo = F, message = F}
library(bldr)
library(dplyr)
library(ggplot2)
library(knitr)
library(purrr)
library(tidyr)

set_ggtheme()

opts_chunk$set(message = F,
               fig.width = 6, fig.height = 3, fig.ext = 'svg', dev = 'svg')
```

A (standard) [Wiener process](https://en.wikipedia.org/wiki/Wiener_process) is a continuous-time stochastic process $\{W(t)\}_{t\ge0}$ with initial value $W(0)=0$ and instantaneous increments
$$\newcommand{\der}{\mathrm{d}}
\der W(t)\sim N(0,\der t).$$
We can simulate such a process as follows.
First, create a sequence of times $t$ at which to store the value of $W(t)$:

```{r}
t_max = 100
dt = 1e-2

t = seq(0, t_max, by = dt)
```

Increasing `t_max` creates a longer path, while decreasing `dt` creates a smoother path.
Now simulate the random increments and take their cumulative sum:

```{r echo = F}
set.seed(0)
```

```{r}
dW = rnorm(length(t) - 1, mean = 0, sd = sqrt(dt))
W = c(0, cumsum(dW))
```

Here are three sample paths generated by this procedure:

```{r wiener-paths, echo = F}
sample_wiener_process = function(t_max = 1, dt = 1e-3) {
  t = seq(0, t_max, by = dt)
  dW = c(0, rnorm(length(t) - 1, 0, sqrt(dt)))
  return (data.frame(t = t, W = cumsum(dW)))
}

set.seed(0)
wp = crossing(realization = 1:3) %>%
  mutate(res = map(realization, ~sample_wiener_process(t_max, dt))) %>%
  unnest('res')

wp %>%
  ggplot(aes(t, W)) +
  geom_line(aes(col = factor(realization)), show.legend = F) +
  labs(y = 'W(x)',
       title = 'Sample paths of a Wiener process',
       subtitle = 'Each path has iid normal increments with zero mean and unit variance') +
  coord_cartesian(clip = 'off')
```

We can use $\{W(t)\}_{t\ge0}$ to construct an [Ornstein-Uhlenbeck process](https://en.wikipedia.org/wiki/Ornsteinâ€“Uhlenbeck_process) $\{X(t)\}_{t\ge0}$.
This process has instantaneous increments
$$\der X(t)=-\theta X(t)\der t+\der W(t),$$
where $\theta\ge0$ controls the process' tendency to [mean-revert](https://en.wikipedia.org/wiki/Regression_toward_the_mean).
We can compute its values $X(t)$ by iterating over `dW`:

```{r}
theta = 1

X = rep(0, length(dW))
i = 1
while (i < length(dW)) {
  X[i + 1] = X[i] - theta * X[i] * dt + dW[i + 1]
  i = i + 1
}
```

The chart below compares the sample paths obtained using different $\theta$ values.
Each path uses the same realization of the underlying Wiener process $\{W(t)\}_{t\ge0}$.
If $\theta=0$ then $X(t)=W(t)$ for all $t\ge0$.
The mean magnitude of $X(t)$ falls as $\theta$ rises because this makes the process more mean-reverting.

```{r orstein-uhlenbeck-paths, echo = F}
get_ou_path = function(theta, wp) {
  t = wp$t
  dW = c(0, diff(wp$W))
  
  X = rep(0, length(t))
  i = 1
  while (i < length(t)) {
    X[i + 1] = X[i] - theta * X[i] * dt + dW[i + 1]
    i = i + 1
  }
  
  return (data.frame(t = t, W = wp$W, X = X))
}

ou = crossing(theta = c(0, 1, 10)) %>%
  mutate(res = map(theta, get_ou_path, wp = filter(wp, realization == 1))) %>%
  unnest('res')

ou %>%
  group_by(theta) %>%
  filter(row_number() %% 10 == 1) %>%  # Prevent over-plotting
  ggplot(aes(t, X)) +
  geom_line(aes(col = paste('\u03b8 =', theta))) +
  labs(y = 'X(t)',
       title = 'Sample paths of an Ornstein-Uhlenbeck process',
       subtitle = 'Each path uses the same realization of the underlying Wiener process',
       col = NULL) +
  coord_cartesian(clip = 'off') +
  theme(legend.justification = c(0, 1),
        legend.position = c(0, 1))
```

```{r session-info, echo = F}
save_session_info()
```
